## Диаграмма взаимодействия слоев приложения

<div align="center">
    <img src="./charts/architecture.svg" alt="Architecture diagram" height="500px">
</div>

## Основные слои приложения

### `store`

Слой базовой конфигурации глобального стора.

- Используется исключительно для инфраструктурных нужд React Native и application level бизнес логики — например, `isSignedIn`, `shouldShowOnboarding`, персист кэша и т. д.
- Не содержит бизнес-логику, связанную с конкретными сущностями.

### `ui-kit`

Набор базовых визуальных компонентов, **не привязанных к предметной области**.

- Компоненты можно создавать тут только если представлена аналогия в других популярных библиотеках (Ant Design, Material Design, UI Kitten)
- Компоненты этого слоя не должны знать о бизнес-контексте приложения

### `core/api`

Слой взаимодействия с backend-API

- DTO и API сервисы в открытом виде (зеркальные определения контроллеров на сервере)
- Позволяет синхронизировать схемы данных и облегчает поддержку

### `core/services`

Слой сервисов, отвечающих за инфраструктурную бизнес-логику

- Примеры: `LocationService`, `PushService`, `PermissionsService`, `HapticsService`, `AnalyticsService`
- Основной слой для тестирования

### `core/hooks`

Объявления хуков, бизнес логика, синхронизированная с жизненным циклом React

- Обёртки для `react-hook-form`, debounce-хуки и т. д.

### `components/infrastructure`

Инфраструктурные компоненты, не относящиеся к бизнес-логике

- Примеры: `NavigatorHeaderTabs`, `EmptyListWarning`, `BlinkAnimator`

### `components/domain`

Компоненты, содержащие бизнес-логику конкретных сущностей

- Директории соответствуют доменам, например: `Patient/Card`, `DoctorCategory/Tag`

### `config`

Общая конфигурация приложения: темы, локализация, цветовые схемы,

### `navigation`

Структура навигации и связи между экранами

### `modals / screens`

Финальные представления (view-слой)

- Каждый экран или модалка объединяет взаимодействие всех нижлежащих уровней (API, store, компоненты и сервисы)
- Суть **screen-first подхода**

## Плюсы и минусы подхода

### Преимущества

- Чёткие и предсказуемые границы между слоями
- Минимум разночтений по структуре и ответственности
- Простая поддержка и масштабирование без потери прозрачности

### Недостатки

- Необходимость дополнительных “прослоек” при интеграции с React (`core/hooks`)
- В редких случаях экраны могут достигать 300–400 строк кода, без возможности фрагментировать их без нарушения принципов архитектуры. Это trade-off в пользу явности: вся логика экрана видна в одном месте, без необходимости прыгать по файлам.

## Рекомендации по компонентам

- **Что может быть частью domain**
  - Если архитектура backend позволяет - приложение может полностью зеркалить сущности исходя из response DTO отправленных backend.
  - Если нет - модули domain - это сущности, с четко определенным названием отражающим их суть. Могут так же определятся, исходя из бизнес требований

- **Выносите в `components/domain` элементы (items), а не списки (lists)**
  - Пример: из списка докторов лучше выделить отдельный `item`, так как он с большей вероятностью будет переиспользоваться
  - Список — это инфраструктурная обёртка, компонуемая из нижлежащих элементов

- **Modals рассматриваются как экраны**
  - В React Native модалки часто реализуются как компоненты
  - Такой подход контринтуитивен: сложно контролировать роутинг и переиспользование модальных окон
  - При верстке ProfileEditingForm приходится вставлять `PickDateModal` и `SelectModal` внутрь, что создаёт сложности
  - Вместо этого модальное окно должно реализовать собственный контракт и стать частью навигации
  - Данные передаются через navigation params, результаты возвращаются через callbacks или navigation events
  - Преимущества: единая система роутинга, возможность deep linking в модалки, нативные анимации

- **Модули (на всех уровнях, кроме config, и store)**
  - Могут реализовывать модульный паттерн, предоставляя фасад для взаимодействия
  - Доступные компоненты модуля: `config.ts`, `utils.ts`, `types.ts`
  - Фасад (`index.ts`) — единственный экспорт наружу, остальные компоненты приватные

## Еще

<ul>
<li><a href="./architecture-reason.md">Предпосылки архитектуры</a></li>
<li><a href="./why-no-cd.md">Почему нет CD</a></li>
<li><a href="./why-no-push.md">Почему нет пушей</a></li>
<li><a href="./why-no-tests.md">Почему нет тестов</a></li>
<li><a href="./why-not-bare.md">Почему Expo, а не Bare React Native</a></li>
</ul>
